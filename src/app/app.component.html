<!DOCTYPE html>
<html>
<body>
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="surface-ground min-h-screen">
  <div class="container mx-auto px-4 py-5">
    <!-- Header -->
    <div class="text-center mb-5" pAnimateOnScroll enterClass="fadeIn">
      <h1 class="text-5xl font-bold text-primary mb-2">
        <i class="pi pi-calendar-plus mr-3"></i>Appointments
      </h1>
      <p class="text-600 text-lg">Manage your appointments efficiently</p>
    </div>

    <!-- Add Appointment Card -->
    <p-card class="mb-5 shadow-2" pAnimateOnScroll enterClass="fadeInLeft">
      <ng-template pTemplate="header">
        <div class="px-5 pt-5">
          <h2 class="text-2xl font-semibold text-primary">
            <i class="pi pi-plus-circle mr-2"></i>New Appointment
          </h2>
        </div>
      </ng-template>
      
      <form (ngSubmit)="add()" class="formgrid grid">
        <div class="field col-12 md:col-6">
          <label for="clientName" class="block mb-2 font-semibold">
            Client Name <span class="text-red-500">*</span>
          </label>
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon">
              <i class="pi pi-user"></i>
            </span>
            <input 
              pInputText 
              id="clientName"
              [(ngModel)]="newClientName" 
              name="client" 
              placeholder="Enter client name" 
              required 
              class="w-full"
              [disabled]="loading"/>
          </div>
        </div>

        <div class="field col-12 md:col-3">
          <label for="startTime" class="block mb-2 font-semibold">
            Start Time <span class="text-red-500">*</span>
          </label>
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon">
              <i class="pi pi-calendar"></i>
            </span>
            <p-datepicker 
              [(ngModel)]="newStartTime" 
              name="start" 
              [showTime]="true"
              [showIcon]="false"
              [minDate]="minDate"
              dateFormat="dd/mm/yy"
              hourFormat="24"
              placeholder="Select start time"
              [disabled]="loading"
              required
              styleClass="w-full">
            </p-datepicker>
          </div>
        </div>

        <div class="field col-12 md:col-3">
          <label for="endTime" class="block mb-2 font-semibold">
            End Time <span class="text-red-500">*</span>
          </label>
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon">
              <i class="pi pi-calendar-times"></i>
            </span>
            <p-datepicker 
              [(ngModel)]="newEndTime" 
              name="end" 
              [showTime]="true"
              [showIcon]="false"
              [minDate]="newStartTime || minDate"
              dateFormat="dd/mm/yy"
              hourFormat="24"
              placeholder="Select end time"
              [disabled]="loading"
              required
              styleClass="w-full">
            </p-datepicker>
          </div>
        </div>

        <div class="field col-12">
          <label for="notes" class="block mb-2 font-semibold">
            Notes <span class="text-500">(optional)</span>
          </label>
          <textarea 
            pTextarea 
            [(ngModel)]="newNotes" 
            name="notes" 
            placeholder="Add any additional notes here..." 
            rows="3"
            [disabled]="loading"
            class="w-full">
          </textarea>
        </div>

        <div class="col-12">
          <p-button 
            type="submit" 
            [label]="loading ? 'Saving...' : 'Add Appointment'"
            [icon]="loading ? 'pi pi-spin pi-spinner' : 'pi pi-plus'"
            [disabled]="loading"
            styleClass="w-full md:w-auto"
            size="large">
          </p-button>
        </div>
      </form>
    </p-card>

    <!-- Loading Spinner -->
    <div *ngIf="loading && appointments.length === 0" class="text-center py-8">
      <p-progressSpinner 
        styleClass="w-4rem h-4rem" 
        strokeWidth="4" 
        animationDuration=".5s">
      </p-progressSpinner>
      <p class="mt-3 text-600">Loading appointments...</p>
    </div>

    <!-- Error Message -->
    <p-message 
      *ngIf="error && !loading" 
      severity="error" 
      [text]="error"
      styleClass="mb-4 w-full">
    </p-message>

    <!-- Appointments List -->
    <p-card *ngIf="!loading || appointments.length >= 0" class="shadow-2" pAnimateOnScroll enterClass="fadeInRight">
      <ng-template pTemplate="header">
        <div class="px-5 pt-5 flex justify-content-between align-items-center">
          <h2 class="text-2xl font-semibold text-primary">
            <i class="pi pi-list mr-2"></i>Upcoming Appointments
          </h2>
          <p-tag 
            [value]="appointments.length + ' Total'" 
            severity="info"
            [rounded]="true">
          </p-tag>
        </div>
      </ng-template>

      <!-- Show appointments or empty message -->
      <div *ngIf="appointments && appointments.length > 0; else emptyState">
        <div *ngFor="let appointment of appointments" class="mb-3">
          <div class="surface-card p-4 border-round shadow-1 hover:shadow-3 transition-all transition-duration-300">
            <div class="flex flex-column md:flex-row md:align-items-center md:justify-content-between">
              <!-- Left side: Client info and times -->
              <div class="flex-1">
                <div class="flex align-items-center mb-3">
                  <div class="surface-100 border-round flex align-items-center justify-content-center mr-3" 
                       style="width: 3rem; height: 3rem;">
                    <i class="pi pi-user text-2xl text-primary"></i>
                  </div>
                  <div>
                    <h3 class="text-xl font-semibold m-0 text-900">{{ appointment.clientName }}</h3>
                    <div class="flex align-items-center mt-1 text-600">
                      <i class="pi pi-clock mr-2"></i>
                      <span class="text-sm">
                        {{ appointment.startTime | date:'MMM d, y Â· h:mm a' }} - 
                        {{ appointment.endTime | date:'h:mm a' }}
                      </span>
                    </div>
                  </div>
                </div>
                
                <div *ngIf="appointment.notes" class="ml-5 pl-3 mb-3">
                  <div class="surface-100 p-3 border-round">
                    <i class="pi pi-file-edit mr-2 text-500"></i>
                    <span class="text-700">{{ appointment.notes }}</span>
                  </div>
                </div>
              </div>

              <!-- Right side: Status and actions -->
              <div class="flex flex-column md:flex-row align-items-start md:align-items-center gap-2 mt-3 md:mt-0">
                <p-tag 
                  [value]="getStatusLabel(appointment.confirmed)" 
                  [severity]="getSeverity(appointment.confirmed)"
                  [icon]="appointment.confirmed ? 'pi pi-check-circle' : 'pi pi-clock'"
                  styleClass="px-3 py-2">
                </p-tag>
                
                <p-button 
                  *ngIf="!appointment.confirmed"
                  icon="pi pi-check" 
                  label="Confirm"
                  (onClick)="confirm(appointment)"
                  severity="success"
                  [outlined]="true"
                  size="small">
                </p-button>
                
                <p-button 
                  icon="pi pi-trash" 
                  (onClick)="delete(appointment.id, appointment.clientName)"
                  severity="danger"
                  [text]="true"
                  [rounded]="true"
                  size="small"
                  pTooltip="Delete appointment"
                  tooltipPosition="top">
                </p-button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <ng-template #emptyState>
        <div class="text-center py-5">
          <i class="pi pi-calendar-times text-5xl text-300 mb-3 block"></i>
          <p class="text-xl text-600">No appointments scheduled</p>
          <p class="text-500">Create your first appointment using the form above</p>
        </div>
      </ng-template>
    </p-card>
  </div>
</div>
</body>
</html>